#!/bin/ksh

OPTERR=0
unset selector

while getopts "vcn:" option; do
  case "${option}" in
    v)
      set -xv
    ;;
    c)
      selector="${selector} -name *.[CcHh]*"
    ;;
    n)
      selector="${selector} -name ${OPTARG}"
    ;;
    *)
      echo "USAGE `basename ${0}` [-d<folder>] [<svn command>]" 1>&2
      exit 2
    ;;
  esac
done
shift $(( ${OPTIND} - 1 ))

[ "${#}" -eq 0 ] && {
  echo "USAGE: `basename ${0}` <location> [ <pattern> [ <extra find options> ...] ]"
  exit 2
}
location="${1}"
pattern="${2}"

[ "${#}" -ne 0 ] && shift
[ "${#}" -ne 0 ] && shift

exec find "${location:-.}" -name .svn -prune -o -type f ${selector} ${pattern:+-exec grep "${pattern}" "{}" \;} "${@:--print}"
