# vim: set ft=ruby:

cache.platform = TSC::Platform.current.name
cache.os = TSC::Platform.current.driver

cache.version = ENV['STEMKIT_VERSION'] || '0.0'

product {
  name 'SK'
  description 'Stemkit'

  top ENV['CONTRIB_ROOT'] || '/usr/local'
  base "stemkit-#{cache.version}"

  version cache.version

  package {
    name 'util'
    description 'Ruby libraries'

    tasks %w{
      system-query-top
      system-create-files
      system-set-permissions
    }
    filesets %w{
      rt
    }
  }
}

fileset {
  name 'rt'

  directory %w{
    lib
    lib/sk
    lib/sk/rt
  }
  install.as('lib/sk/rt').source {
    tree('extensions/sk/rt') { |_location, _item|
      case _item
        when '.svn'
          nil
        when %r{^.+-spec.rb$}
          false
        else
          true
      end
    }
  }
  install.into('lib/sk').binary {
    program 'extensions/sk/rt.so'
  }
}
